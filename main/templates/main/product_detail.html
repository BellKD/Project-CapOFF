{% extends "base.html" %}

{% block content %}
<div class="container mt-5">

    <!-- Уведомления -->
    {% if messages %}
      <div class="messages position-fixed top-0 end-0 p-3" style="z-index: 1100;">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="row">
        <!-- Фото товара -->
        <div class="col-md-6 text-center">
            <img src="{{ product.cover.url }}"
                  alt="{{ product.title }}"
                  style="width: 100%; max-width: 500px; height: auto; object-fit: contain;">
        </div>

        <!-- Описание товара -->
        <div class="col-md-6 d-flex flex-column justify-content-start">
            <h2 class="fw-bold">{{ product.title }}</h2>

            {% if product.discount_price %}
                <p class="text-muted text-decoration-line-through">${{ product.price }}</p>
                <p class="fw-bold h4 text-danger">${{ product.discount_price }}</p>
            {% else %}
                <br><br>
                <p class="fw-bold h4">${{ product.price }}</p>
            {% endif %}

            <p class="mt-2">{{ product.description }}</p>

            <!-- Форма выбора размера и добавления в корзину -->
            <div class="mt-4">
                <form action="{% url 'add_to_basket' product.id %}" method="post">
                    {% csrf_token %}
                    <h6 class="fw-bold mb-2">Выберите размер:</h6>
                    <div class="btn-group" role="group" aria-label="Выбор размера">
                        {% for storage in product.storage_set.all %}
                            <input type="radio" class="btn-check" name="size" id="size{{ storage.size.id }}" value="{{ storage.size.id }}" autocomplete="off" {% if forloop.first %}checked{% endif %}>
                            <label class="btn btn-outline-dark" for="size{{ storage.size.id }}">{{ storage.size.title }}</label>
                        {% endfor %}
                    </div>
                    <div class="mt-3">
                        <button type="submit" class="btn btn-dark fw-bold px-4 py-2">
                            🛒 Добавить в корзину
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<div class="container mt-5 mb-5">
  <h5 class="fw-bold mb-3">Похожие товары</h5>
  <div class="row row-cols-2 row-cols-md-4 g-4">
    {% for related in related_products %}
      <div class="col">
        <div class="card h-100 text-center" style="max-width: 180px; margin: auto;">
          <img src="{{ related.cover.url }}" class="card-img-top" alt="{{ related.title }}" style="height: 180px; object-fit: cover;">
          <div class="card-body">
            <h6 class="card-title">{{ related.title }}</h6>
            <p class="fw-bold">${{ related.price }}</p>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
